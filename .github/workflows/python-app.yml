name: find-my-yaml

on:
  push:
    branches: [ "main" ]
  paths-ignore: 
  - 'output/**'
  pull_request:
    branches: [ "main" ]

permissions:
  contents: read

jobs:
  build:

    runs-on: ubuntu-latest

    steps:
    - name: check out main repo
      uses: actions/checkout@v3
      
    - name: Checkout yamlfinder
      uses: actions/checkout@v3
      with:
        repository: jinopl/yamlfinder
        path: tools
        
    - name: Set up Python 3.10
      uses: actions/setup-python@v3
      with:
        python-version: "3.10"
        
    - name: Install dependencies
      run: pip install argparse datetime

    - name: Run yaml finder
      run: | 
        python3 yamlfinder.py --ifile ../filenames.txt --ofile outputfile.txt
        mv outputfile.txt ../output/
      working-directory: ./tools/

    - name: Remove tool folders
      run: rm -rf tools
    
    - name: Push output file to github
      run: |
        ls -l
        git config user.name github-actions
        git config user.email github-actions@github.com
        git status
        git add .
        git commit -m "Adding outputfile by github actions"
        git push

        
